<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./Style/styleSP.css">
    <link rel="stylesheet" href="./Style/stylepp.css">
    <script src="/monaco/vs/loader.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="PP">
        <h2 align="center" id="username"></h2>
        </div>
       
    <div class="profile-container">
        <!-- قسم ملف اللاعب -->
        <div class="player-profile">
           
                <div>
                    <h2 class="username">DETAILS</h2>
                   
                </div>

    
            <div class="player-info-grid">
                <div class="info-card">
                    <div class="info-label">Challenge</div>
                    <div class="info-value" style="color: blueviolet;" id="challengeTitle">Division of Two Numbers</div>
                    <div class="info-value" id="challengeTxt">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illum eligendi vero mollitia amet, ducimus rerum veniam sint, unde error eos doloremque officia harum! Saepe, aut autem iste nobis deserunt optio.</div>
                    <div class="info-value" id="challengeSample">Sample</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Programming Language</div>
                    <div class="info-value" id="language"></div>
                </div>
                <div class="info-card">
                    <div class="info-label">Difficulty</div>
                    <div class="info-value" id="difficulty"></div>
                </div>
                
            </div>
        </div>
    
        <!-- قسم تاريخ المباريات -->
        <div class="history-container">
            <h2 class="history-header">YOUR CODE</h2>
            <div class="games-list">
                <div class="game-entry">
                    <div class="game-mode" style="width: 100%; height: 400px;">
                        <div id="monaco-editor-container" style="width: 100%; height: 100%;"></div>
                    </div>
                </div>
            </div>
            <div class="info-card" style="margin-top: 20px;">
                <div class="info-label">Compiler Output</div>
                <pre id="compilerOutput" class="compiler-output" style="background: #1e1e1e; color: #d4d4d4; padding: 10px; border-radius: 4px; overflow-x: auto; font-family: 'Courier New', monospace; min-height: 50px;"></pre>
            </div>
            <div class="info-card">
                    <div class="info-label">Result</div>
                    <div class="info-value" id="result"></div>
                </div>
            <button class="submissions-toggle-btn" onclick="window.location.href='AllSubmissions.html'"  id="globalBtn">GLOBAL SUBMSSIONS</button>
            <button class="submissions-toggle-btn"  onclick="window.location.href='SubmationsPage.html'">BACK</button>
        </div> 
    </div>
 
</body>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    submissionId = urlParams.get('id');
    
    async function fetchDetails() {
        try {
            const response = await fetch(`/api/submissions/${submissionId}`, {
                credentials: 'include'
            });

            if(!response.ok){
                throw new Error("Failed to Fetch user's submissions");
            }

            return response.json();
        } catch (error) {
            console.error('Error fetching submissions:', error);
            return null;
        }
    }
    async function displayFunction() {
        const response = await fetchDetails();
        console.log(response)
        document.getElementById("username").innerHTML = response.username;
        document.getElementById("challengeTitle").innerHTML = response.title;
        document.getElementById("challengeTxt").innerHTML = response.description;
        document.getElementById("language").innerHTML = response.programmingLanguage;
        document.getElementById("result").innerHTML = response.result;
        document.getElementById("difficulty").innerHTML = response.difficulty;
        document.getElementById("compilerOutput").textContent = response.compileOutput || "No compiler output available.";
        
        document.getElementById("globalBtn").addEventListener("click", function() {
            window.location.href=`AllSubmissions.html?challengeId=${response.challengeId}`
        });

        // Initialize Monaco Editor
        require.config({ paths: { 'vs': '/monaco/vs' }});
        require(['vs/editor/editor.main'], function() {
            const editor = monaco.editor.create(document.getElementById('monaco-editor-container'), {
                value: response.code,
                language: response.programmingLanguage.toLowerCase() === 'java' ? 'java' : 'python',
                theme: 'vs-dark',
                readOnly: true,
                automaticLayout: true,
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                fontSize: 14
            });
        });
    }
    displayFunction();


</script>
</html>