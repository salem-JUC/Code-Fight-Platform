<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./Style/styleSP.css">
    <link rel="stylesheet" href="./Style/stylepp.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./Script/auth-guard.js" defer></script>
    <title>Submissions Table</title>
</head>
<body>
    
<h1>Submissions Table</h1>

<table>
    <thead>
        <tr>
            <th>Submission ID</th>
            <th>Challenge Title</th>
            <th>Difficulty</th>
            <th>Programming Language</th>
            <th>Result</th>
        </tr>
    </thead>
    <tbody id="table-body">
        
    </tbody>
</table>
<button class="submissions-toggle-btn"  onclick="window.location.href='ProfilePage.html'">BACK</button>

</body>
<script>
    async function fetchCurrentUser() {
        const cached = window.getCachedUser?.();
        if (cached) {
            return cached;
        }
        if (window.ensureAuthenticatedUser) {
            return await window.ensureAuthenticatedUser();
        }
        return null;
    }

    async function getUserSubmission() {
        try {
            const response = await fetch('/api/submissions', {
                credentials: 'include'
            });

            if(!response.ok){
                throw new Error("Failed to Fetch user's submissions");
            }

            return response.json();
        } catch (error) {
            console.error('Error fetching submissions:', error);
            return null;
        }
    }

    async function displaySubmissions(){
        const submissions = await getUserSubmission();
        tbody = document.getElementById("table-body")
        for await (const submission of submissions) {
            console.log(submission)
            const row = document.createElement('tr');
            row.innerHTML = `
                <td data-label="Submission ID">
                    <a href="submissionDetails.html?id=${submission.submissionID}">${submission.submissionID}</a>
                </td>
                <td data-label="Challenge Title">${submission.challengeTitle}</td>
                <td data-label="Difficulty">${submission.difficulty}</td>
                <td data-label="Programming Language">${submission.programmingLanguage}</td>
                <td data-label="Result">${submission.result}</td>
            `;
            tbody.appendChild(row);
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        displaySubmissions();
    });
</script>
</html>
