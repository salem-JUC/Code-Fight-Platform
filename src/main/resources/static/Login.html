<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="./Style/styleHP.css">
    
    
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <title>Code Fight</title>
</head>
<body>

    <header class = "header">
       
        <a href="#" class="Logo"> Code Fight </a>
        

    <br><br><br><br><br>
    <br><br><br><br>
    <br><br><br><br><br>
        <nav class="navbar">
            <button class="btnlogin-popup" onclick="playSFXByName('click')"> <p>Log in</p></button> 
            <br><br>
            <br><br><br><br>
            <button class="btnregister-popup" onclick="playSFXByName('click')"> <p>Register</p> </button> 
         
   </nav>
</header>
<section class="section">

    <div class="settings-container">
        <button class="settings-btn-1" id="settingsBtn" onclick="playSFXByName('click')">
            <i class="fas fa-cog"></i>
        </button>
    </div>
    
    
    <div class="wSetting" id="settingsPopup">
        <span class="icon-close-Settings" id="closeSettings">
            <i class='bx bx-x'></i>
        </span>
        
            
            <div class="Setting-box">
                <div class="form-box settings">
                    <div class="Setting-title">
                        <h2 class="settings-heading" >Settings</h2>
                    </div>
                    
                    <!-- ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div class="settings-content">
    <!-- Music Settings -->
    <div class="Input-Setting">
        <div class="audio-controls">
            <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ -->
            <div class="control-item">
                <label class="control-label">
                    <input type="checkbox" id="musicMute">
                    <span class="checkmark"></span>
                    Music Mute
                </label>
            </div>
            
            <div class="control-item volume-control">
                <label class="control-label">
                    Music Volume
                    <input type="range" class="volume-slider" id="musicVolume" min="0" max="1" step="0.1" value="1">
                    
                </label>
                
            </div>

            <!-- SFX Controls -->
            <div class="control-item">
                <label class="control-label">
                    <input type="checkbox" id="sfxMute">
                    <span class="checkmark"></span>
                    SFX Mute
                </label>
            </div>
            
            <div class="control-item volume-control">
                <label class="control-label">
                    SFX Volume
                    <input type="range" class="volume-slider" id="sfxVolume" min="0" max="1" step="0.1" value="1">
                   
                </label>
            </div>
        </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØ© -->
    <div class="settings-buttons">
        <button class="settings-btn info-btn" onclick="window.location.href='AboutUs.html'">
            <i class='bx bx-info-circle'></i>
            About Us
        </button>
        
        </button>
        <button class="settings-btn report-btn" onclick="window.location.href='ReportBugs.html'">
            <i class='bx bx-bug'></i>
            Report Bug
        </button>
    </div>
</div></div></div></div>

    <div class="wrapper">
        <span class="icon-close"><i class='bx bx-x'></i>

        </span>
        <div class="logreg-box">
            <!--login form-->
            <div class="form-box login">
                <div class="logreg-title">
                    <h2>Log in</h2>
                    <p>Please Login to use the platform</p>
                    </div>
                    <form >
                        <div class="Input-box">
                            <span class="icon"><i class='bx bxs-envelope'></i>
                            </span>
                            <input id="usernameLogin" type="username" required>
                            <label >Username</label>
                            </div>
                            <div class="Input-box">
                                <span class="icon"><i class='bx bxs-lock-alt'></i></span>
                                <input id="passwordLogin" type="password" required>
                                <label >Password</label>
                        </div>
                        <div class="remember-forgot">
                            <label >
                                <input type="checkbox" >
                                Remember me
                            </label>
                            <a href="#">Forgot password ? </a>
                        </div>
                            <button onclick="login(event)"  class="btn">Login</button>
                            <div class="logreg-link">
                                <p>Don't have an account ? <a href="/"class = "register-link">register</a></p>
                            </div>
                    </form>
                
            </div>
            <!--register form -->
            <div class="form-box register">
                <div class="logreg-title">
                    <h2>Register</h2>
                    <p>Please Register to use the platform</p>
                    </div>
                    <form action="./MineMenu.html">
                        <div class="Input-box">
                            <span class="icon"><i class='bx bx-user'></i>
                            </span>
                            <input id="usernameRegister" type="text" required>
                            <label >Username</label>
                            </div>
                        <div class="Input-box">
                            <span class="icon"><i class='bx bxs-envelope'></i>
                            </span>
                            <input id="emailRegister" type="email" required>
                            <label >Email</label>
                            </div>
                            <div class="Input-box">
                                <span class="icon"><i class='bx bxs-lock-alt'></i></span>
                                <input id="passwordRegister" type="password" class="password" required>
                                <label>Password</label>
                                <small id="passwordHelp" class="help-text"></small>
                            </div>
                            
                        <div class="remember-forgot">
                            <label >
                                <input type="checkbox"  class="T">
                                <a href="terms and conditions.html">terms and conditions</a>
                            </label>
                            
                        </div>
                            <button class="btn" onclick="register(event)">Register</button>
                            <div class="logreg-link">
                                <p>Do you have account <a href="#"class = "login-link">Log in</a></p>
                            </div>
                    </form>
                
            </div>
        </div>
    
    </div>
</section>
    <script>


        async function login(event) {
            event.preventDefault();

            // Validate form before submission
            if (!window.validateLoginForm) {
                // Validation script not loaded yet
                showGameError('Validation system not ready. Please refresh the page.');
                return;
            }

            if (!window.validateLoginForm()) {
                return; // Validation failed, error already shown
            }

            const username = document.getElementById("usernameLogin").value
            const password = document.getElementById("passwordLogin").value;

            const formData = new FormData();
            formData.append('username', username);
            formData.append('password', password);

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    showGameSuccess('Login successful! Redirecting...');
                    setTimeout(() => {
                        window.location.href = '/MineMenu.html';
                    }, 1000);
                } else {
                    const errorData = await response.json().catch(() => ({ message: response.statusText }));
                    showGameError(errorData.message || 'Invalid credentials. Please check your username and password.');
                }
            } catch (error) {
                showGameError('Connection error: ' + error.message);
            }
        }
        
        async function register(event) {
            event.preventDefault();

            // Validate form before submission
            if (!window.validateRegisterForm) {
                // Validation script not loaded yet
                showGameError('Validation system not ready. Please refresh the page.');
                return;
            }

            if (!window.validateRegisterForm()) {
                return; // Validation failed, error already shown
            }

            const username = document.getElementById("usernameRegister").value;
            const email = document.getElementById("emailRegister").value;
            const password = document.getElementById("passwordRegister").value;

            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        email: email,
                        password: password
                    }),
                });

                if (response.ok || response.status === 201) {
                    showGameSuccess('ðŸŽ‰ Registration Successful! Please log in to continue.', 5000);
                    // Clear the form
                    document.getElementById("usernameRegister").value = '';
                    document.getElementById("emailRegister").value = '';
                    document.getElementById("passwordRegister").value = '';
                    // Switch to login form
                    const wrapper = document.querySelector('.wrapper');
                    if (wrapper) {
                        wrapper.classList.remove('activeR');
                        wrapper.classList.add('active');
                    }
                } else {
                    let errorMessage = 'Registration failed. Please try again.';
                    if (response.status === 409) {
                        errorMessage = await response.text().catch(() => errorMessage);
                    } else {
                        const errorData = await response.json().catch(() => null);
                        if (errorData && typeof errorData.message === 'string') {
                            errorMessage = errorData.message;
                        }
                    }
                    showGameError(errorMessage || 'Registration failed. Please try again.');
                }
            } catch (error) {
                showGameError('Connection error: ' + error.message);
            }

        }
        
    </script>
<script src="./Script/FormValidation.js"></script>
<script src="./Script/PasswordLogic.js"></script>
<script src="./Script/LogReg.js"></script>
<script src="./Script/Sounds.js"></script>



</body>
</html>

